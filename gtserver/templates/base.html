{% load static %}
<!DOCTYPE html>
<html style="min-height: 100%;background-image: url('{% static 'img/joga_background.svg' %}'); background-repeat: no-repeat; background-position: right bottom;">
  <head>
    <!--Import JQuery-->
    <script type="text/javascript" src="{% static 'js/jquery-3.5.1.min.js' %}"></script>

    <!--Import materialize.css-->
    {% if company == 'joga' %}
    <link type="text/css" rel="stylesheet" href="{% static 'css/materialize_light-blue.min.css' %}"  media="screen,projection"/>
    {% elif company == 'supplier' %}
    <link type="text/css" rel="stylesheet" href="{% static 'css/materialize_green.min.css' %}"  media="screen,projection"/>
    {% elif company == 'customer' %}
    <link type="text/css" rel="stylesheet" href="{% static 'css/materialize_red.min.css' %}"  media="screen,projection"/>
    {% else %}
    <link type="text/css" rel="stylesheet" href="{% static 'css/materialize_grey.min.css' %}"  media="screen,projection"/>
    {% endif %}
    
    <!--Import materialize.js-->
    <script type="text/javascript" src="{% static 'js/materialize.min.js' %}"></script>

    <!--Import materialize.icons.css-->
    <link type="text/css" rel="stylesheet" href="{% static 'css/materialize.icons.css' %}"/>

    <!--Import custom.css-->
    <link type="text/css" rel="stylesheet" href="{% static 'css/custom.css' %}"/>

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <title>{{title}}</title>
    
    <!-- Head-->
    {% block head %}

    {% endblock %}

  </head>

  <body>

    <!-- Navbar-->
    <div class="navbar-fixed" style="z-index: 9999;">
      <nav>
        <div class="nav-wrapper">
          <a href="#" data-target="sidenav" class="sidenav-trigger"><i class="material-icons">menu</i></a>
          <a href="{% url 'home' %}" class="hide-on-med-and-down brand-logo left">{% if company == 'joga' %}JOGA{% else %}{{ user.groups.first.name_de }}{% endif %}</a>
          {% if user.is_authenticated %}
          <ul class="right">
            <li><a id="currenttime"><i class="material-icons left">today</i>Tag {{day}}</a>
            {% if perms.gtapp.view_message %}<li><a href=""><i class="material-icons">chat_bubble</i></a></li>{% endif %}
            {% if perms.gtapp.view_suppcontainer or perms.gtapp.view_custcontainer %}<li><a href=""><i class="material-icons">qr_code</i></a></li>{% endif %}
            {% if perms.gtapp.view_todo %}<li><a href="{% url 'tasks' %}"><i class="material-icons">notifications</i></a></li>{% endif %}
            <li ><a class="dropdown-trigger" href="#" data-target="userdropdown"><i class="material-icons left">person</i>{{ user.username }}</a></li>
          </ul>
          {% else %}
          <ul class="right">
            <li><a href="{% url 'login' %}"><i class="material-icons left">login</i>Einloggen</a></li>
          </ul>
          {% endif %}

          
        </div>
      </nav>
    </div>

    {% if user.is_authenticated %}
    <!-- Dropdown Structure -->
    <ul id="userdropdown" class="dropdown-content">
      {% if debug_flag %}
      <li><a href="{% url 'change_user' %}"><i class="material-icons left">people</i>Benutzer wechseln</a></li>
      <li class="divider"></li>
      {% endif %}
      <li><a href="{% url 'logout' %}"><i class="material-icons left">exit_to_app</i>Ausloggen</a></li>
    </ul>
    {% endif %}

    {% if user.is_authenticated %}
    <!-- Sidenav-->
    <ul class="sidenav sidenav-fixed" id="sidenav" >
      <li class="hide-on-med-and-down" style="height: 64px"></li>
      <li><div class="user-view">
        <div class="background">
          <img style="filter: brightness(50%);" src="{% static 'img/logistics-300px.jpg' %}">
        </div>
        <a><img class="grey lighten-2 circle" src="{% static 'img/avataaars.svg' %}"></a>
        <!--<i class="material-icons center-align">person</i>-->
        <a><span class="white-text name">{{ user.username }}</span></a>
        <a><span class="white-text email">{{ user.groups.first.name_de }}</span></a>
      </div></li>
      <li{% if active == "Startseite" %} class="active"{% endif %}><a href="{% url 'home' %}">Startseite</a></li>
      {% if perms.gtapp.view_todo %}<li{% if active == "Aufgaben" %} class="active"{% endif %}><a href="{% url 'tasks' %}">Aufgaben</a></li>{% endif %}
      <li><div class="divider"></div></li>
      {# <li><a class="subheader">Meine Seiten</a></li> #}
      {% if perms.gtapp.view_custorder %}<li{% if active == "Aufträge" %} class="active"{% endif %}><a href="{% url 'cust_order' %}">{% if company == 'customer' %}Bestellungen{% else %}Aufträge{% endif %}</a></li>{% endif %}
      {% if perms.gtapp.view_custcomplaint %}<li{% if active == "Auftragsreklamationen" %} class="active"{% endif %}><a href="">{% if company == 'customer' %}Bestellreklamationen{% else %}Auftragsreklamationen{% endif %}</a></li>{% endif %}
      {% if perms.gtapp.view_supporder %}<li{% if active == "Bestellungen" %} class="active"{% endif %}><a href="">{% if company == 'supplier' %}Aufträge{% else %}Bestellungen{% endif %}</a></li>{% endif %}
      {% if perms.gtapp.view_suppcomplaint %}<li{% if active == "Bestellreklamationen" %} class="active"{% endif %}><a href="">{% if company == 'supplier' %}Auftragsreklamationen{% else %}Bestellreklamationen{% endif %}</a></li>{% endif %}
      {# <li><div class="divider"></div></li> #}
      {# <li{% if active == "Dashboard" %} class="active"{% endif %}><a href="">Dashboard</a></li> #}
    </ul>
    {% endif %}

    <!-- Content-->
    <main {% if user.is_authenticated %}class="loggedin"{% endif %}>
      <div id="content" class="container">
        {% block content %}
        {% endblock %}
      </div>
    </main>
    <!-- Additional Body-->
    {% block body %}

    {% endblock %}

    <!-- Scripts-->
    <script type="text/javascript">
        $(document).ready(function(){
          $('.sidenav').sidenav();
          $(".dropdown-trigger").dropdown();
        });
    </script>
    <script type="text/javascript">
      $(document).ready(function(){
        setInterval(getasyncinformation, 5000);
      });
      function getasyncinformation(){
          var request = new XMLHttpRequest();
          request.open("GET","/api/");
          request.addEventListener('load', function(event) {
            if (request.status >= 200 && request.status < 300) {
              var obj = JSON.parse(request.responseText);
              // Werte setzen
              $('#currenttime')[0].innerHTML = '<i class="material-icons left">today</i> Tag ' + obj['time']
            } else {
              console.warn(request.statusText, request.responseText);
            }
          });
          request.send();
        }
    </script>
    {% block scripts %}
    {% endblock %}
  </body>
</html>